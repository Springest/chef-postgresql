<% node["postgres"]["cluster"]["servers"].each_with_index do |srv,i| %>
backend_hostname<%= i %> = '<%= srv['ip'] %>'
backend_port<%= i %> = 5432
backend_weight<%= i %> = <%= srv['weight'] %>
backend_data_directory<%= i %> = '/var/lib/postgresql/9.2/main/'
backend_flag<%= i %> = 'ALLOW_TO_FAILOVER'
<% end %>

replication_mode = true
load_balance_mode = true
listen_addresses = '*'
port = 5432
pcp_port = 9898
log_destination = 'syslog'
insert_lock = on
socket_dir = '/var/run/postgresql'
pool_passwd = ''

# memory query cache
memory_cache_enabled = on
memqcache_total_size = <%= node["postgres"]["memqcache_total_size"] %>
memqcache_max_num_cache = 500000

# do we want this? also requires ssl_key and ssl_cert
# ssl = true

# connection pooling
num_init_children = 1000
max_pool = 4
connection_life_time = 0
child_max_connections = 0
child_life_time = 300
