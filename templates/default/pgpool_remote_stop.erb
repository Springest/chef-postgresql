#!/bin/bash

SSH=/usr/bin/ssh
LOGGER="log /var/log/postgresql/pgpool_remote_start.log"
DST_DB_STOP="/usr/bin/service postgresql stop"

BASENAME=`/usr/bin/basename $0`
ID=`/usr/bin/id -un`

DST_HOST=$1
DST_DIR=$2

log()
{
echo $(date +"%D %T") $2 >> $1
}

$LOGGER "Executing $BASENAME as user $ID"
$LOGGER "Stopping remote PostgreSQL server"
$SSH -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null $DST_HOST $DST_DB_STOP 2>>/var/log/postgresql/pgpool_remote_start.log 1>>/var/log/postgresql/pgpool_remote_start.log
$LOGGER "Remote PostgeSQL server started."

exit 0
